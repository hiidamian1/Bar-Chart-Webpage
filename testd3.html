<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <script src="https://d3js.org/d3.v5.min.js"></script>

        <style>
            .axis path,
            .axis line {
            	fill: none;
            	stroke: #000;
            	shape-rendering: crispEdges;
            }
            .x.axis path {
            	display: none;
            }
            body {
            	font: 10px arial;
            	text-align: center;
            }
        </style>
    </head>
    
    <body>
    </body>

	<script>
		//margins for graph
		const margin = {top:20, right:30, bottom:30, left:40};
		const width = 800-margin.left-margin.right;
		const height = 400-margin.top-margin.bottom;

		//x and y scale
		var yScale = d3.scaleLinear().range([height,0]);
		var xScale = d3.scaleBand().rangeRound([0,width],0.1,0.2);
		
		//colors
		const c10 = d3.scaleOrdinal(d3.schemeCategory10);

		//scalable vector graphic (svg)
		var svg = d3.select("body")
			.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform","translate(" + margin.left + "," + margin.right + ")");
		
		//read data
		d3.csv("https://raw.githubusercontent.com/neo4j-examples/neo4j-foodmart-dataset/master/data/sales.csv").then(function(data){

			//build Map mapping store_id to unit_sales
			var total_sales = new Map();
			for (var i = 0; i < data.length; i++){
				if (total_sales.has(data[i].store_id)){
					total_sales.set(data[i].store_id, total_sales.get(data[i].store_id) + (+data[i].unit_sales));
				} else {
					total_sales.set(data[i].store_id, +data[i].unit_sales);
				}
			}

			//set domains of x and y scales			
			yScale.domain([0,d3.max(Array.from(total_sales.values()))]);
			xScale.domain(Array.from(total_sales.keys()));

			//convert total_sales map to array for use with d3
			var total_sales_arr = Array.from(total_sales.entries());
			//console.log(total_sales_arr[1]);
			//create x and y axes
			var xAxis = d3.axisBottom(xScale);
			var yAxis = d3.axisLeft(yScale);

			//draw bars and set needed attributes using d3
			var bars = svg.selectAll("rect")
						.data(total_sales_arr)
						.enter()
						.append("rect")
						.attr("class", "bar")
						.attr("width", xScale.bandwidth())
						.attr("fill", "steelblue")
						//fill bars with a random color
						.attr("fill", function(d, i){
							return c10(Math.random() * 10 * i);
						})
						.attr("y", function(d){
							console.log(d[1]);
							return yScale(d[1]);
						})
						.attr("x", function(d){
							return xScale(d[0]);
						})
						.attr("height", function(d){
							return height - yScale(d[1]);
						});

			svg.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(xAxis)
			.attr("class", "x axis");
			svg.append("g")
			.attr("class", "y axis")
			.call(yAxis);
		
		});
	</script>
</html>